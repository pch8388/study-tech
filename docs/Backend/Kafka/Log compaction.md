# 시간기반 보존정책
```
cleanup.policy = delete
retention.ms = 60480000
```
- 위와 같이 설정 시 7일 이후 삭제
- 세그먼트 단위로 삭제되기 때문에 7일이 자닜다고 해서 반드시 삭제되지는 않음

# 키기반 보존정책
```
cleanup.policy = compact
```
- 위와 같이 설정 시 키를 기반으로 압축하는 정책을 사용
- 해당 키의 가장 마지막의 값을 가지고 있도록 하여 압축하는 방식
- 압축은 항상 각 키의 최신 값을 유지하기 때문에 ksqlDB 테이블 또는 Kafka Streams KTables에 백업을 제공하는 데 적합

## 압축 프로세스
- 압축할 세그먼트 결정
  - 압축이 끝난 세그먼트의 뒤 ~ 현재 사용중(기록중)인 세그먼트 사이의 세그먼트들을 대상으로 함
- 키를 기반으로 동일한 값이 있다면 타임스탬프가 뒤인 값을 선택 (동일한 값을 탐색하는 것에는 압축이 끝난 세그먼트도 포함한다)
- 압축 대상 세그먼트들을 위에서 mapping 한 key-value 로 기록
- 새로 로그를 적재했기 때문에 이전의 세그먼트들을 삭제

[참고](https://developer.confluent.io/learn-kafka/architecture/compaction/)