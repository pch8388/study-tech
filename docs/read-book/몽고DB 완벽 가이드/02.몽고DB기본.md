# 기본 개념
- 도큐먼트 : 데이터베이스의 행과 유사 => 다양한 자료 표현 가능
- 컬렉션 : 테이블과 유사
- 몽고DB 의 단일 인스턴스는 자체적인 컬렉션ㅇㄹ 갖는 여러개의 독립적인 데이터베이스를 호스팅
- 모든 도큐먼트는 컬렉션 내에서 유니크한 "_id" 값을 가짐
- mongo shell
  - 몽고DB 인스턴스 관리
  - 쿼리 언어로 데이터 조작을 위한 내장지원 제공
  - Javascript Interpreter

# 도큐먼트
- 정렬된 키와 연결된 값의 집합
- 키는 UTF-8 문자열이면 아래의 경우를 제외하고 모두 가능
  - \0(null 문자) 포함하지 않음
  - .과 $ 는 특별한 속성을 가지므로 예약어 취급한다
- **<u>몽고DB 는 데이터형과 대소문자를 구별한다</u>**
- **키가 중복될 수 없다**

```javascript
// 둘은 다른 도큐먼트로 취급 => 자료형 다름
{"count" : 5}
{"count" : "5"}

// 둘은 다른 도큐먼트로 취급 => 키가 다름
{"count" : 5}
{"Count" : 5}
```

# 컬렉션
- 도큐먼트의 모음

## 동적 스키마
- 컬렉션은 동적 스키마를 가진다
  - 하나의 컬렉션 내 도큐먼트들이 모두 다른 구조를 가질 수 있다
  ```javascript
  // 아래의 두 도큐먼트를 하나의 컬렉션에 넣는 것이 가능
  {"firstname" : "Kim", "age" : 20}
  {"lastname" : "SC"}
  ```
- 동적 스키마지만 컬렉션이 필요한 이유
  - 같은 컬렉션에 다른 종류의 도큐먼트를 저장하면 개발자와 관리자에게 번거로운 일이 생길 수 있음
  - 컬렉션별로 목록을 뽑으면 한 컬렉션 내 특정 데이터형별로 쿼리해서 목록을 뽑을 때보다 속도가 빠름
  - 같은 종류의 데이터를 컬렉션별로 모아두면 data locality 에 좋음
  - 인덱스를 만들면 도큐먼트는 특정 구조를 가져야 한다 => 컬렉션을 효율적으로 인덱싱
- 도큐먼트를 그룹화 함으로써 몽고DB 의 [도큐먼트 유효성 검사 기능](https://docs.mongodb.com/manual/core/schema-validation/) 과 객체-도큐먼트 매핑 라이브러리(object-document mapping library)를 사용할 수 있다

## 네이밍
- 컬렉션은 이름으로 식별
- 서브컬렉션은 네임스페이스에 .(마침표) 를 사용해 컬렉션을 체계화
  - 자식 컬렉션등과는 관계없이 단지 이름을 체계적으로 관리하기 위함

### 컬렉션명 제약 조건
- 빈 문자열("")은 사용 불가
- \0(null 문자) 포함하지 않음
- system. 으로 시작하는 컬렉션명은 시스템 컬렉션에서 사용하는 예약어이므로 사용 불가
- 사용자가 만든 컬렉션은 이름에 예약어인 $ 포함 불가


# 데이터베이스
- 컬렉션의 모음
- 몽고DB 의 단일 인스턴스는 여러 데이터베이스를 호스팅, 각 데이터베이스를 완전히 독립적으로 취급
- 데이터베이스는 이름으로 식별

## 데이터베이스명 제약 조건
- 빈 문자열("")은 사용 불가
- 다음 문자를 포함할 수 없다. /, \, ., ' ', *, <, >, :, |, ?, $, (단일 공간 single space), \0(null 문자)
- 대소문자 구별
- 최대 64바이트

## 데이터베이스명 예약어
### admin
인증(authentication)과 권한부여(authorization) 역할

### local
local 데이터베이스는 단일 서버에 대한 데이터를 저장

### config
샤딩(sharding)된 몽고DB 클러스터는 config 데이터베이스를 사용해 각 샤드의 정보 저장

# 몽고DB 시작
- cli 환경에서 mongod 실행파일 실행
- 기본포트 : 27017

# 몽고DB shell
## shell 실행
```shell
$ mongo
```
- shell 은 완전한 자바스크립트 해석기

## 몽고DB 클라이언트
- shell 은 독자적으로 쓸 수 있는 몽고DB 클라이언트

### 간단한 명령어
- 현재 할당된 데이터베이스 확인
```shell
$ db
```

- 데이터베이스 선택
```shell
$ use 데이터베이스명
```

- 컬렉션 접근
```shell
$ db.컬렉션명
```

## shell 기본 작업
### 생성
- insertOne : 컬렉션에 도큐먼트 추가
```shell
$ db.movies.insertOne({"title": "Star Wars", "year" 1977})
```

### 읽기
- find, findOne : 컬렉션 조회
```shell
$ db.movies.findOne()
```
- 쿼리 도큐먼트 형태로 조건 전달
```shell
$ db.movies.find({"title":"Star Wars"})
```

### 갱신
- updateOne : 도큐먼트 갱신
  - 두 개이상의 매개변수를 받음
  - 수정할 도큐먼트 조회 기준, 갱신작업을 설명할 도큐먼트
  ```shell
  $ db.movies.updateOne({"title":"Star Wars"}, {$set: {reviews:[]})
  ```

### 삭제
- deleteOne, deleteMany : 도큐먼트 삭제
- deleteMany 는 필터와 일치하는 모든 도큐먼트를 삭제한다
```shell
  $ db.movies.updateOne({"title":"Star Wars"})
  ```

# 데이터형
## 기본 데이터형
- null
- boolean
- 숫자 : 64비트 부동소수점 수
  - 4바이트 혹은 8바이트 부호 정수는 NumberInt, NumberLong 클래스 사용
  ```javascript
  {"x":NumberInt("3")}
  {"x":NumberLong("3")}
  ```
- 문자열
- 날짜
- 정규표현식
- 배열
- nested document(내장 도큐먼트)
- 객체ID : 도큐먼트용 12바이트 ID
- 이전데이터 : 임의의 바이트 문자열
- 코드 : 쿼리와 도큐먼트는 임의의 자바스크립트 코드를 포함할 수 있다

## 날짜
- 새로운 Date 객체를 생성할 때는 항상 `Date()` 가 아닌 `new DATE()` 호출
  - `Date()`로 호출하면 실제 Date 객체가 아닌 날짜에 대한 문자열 표현을 반환하기 때문

## 배열
- 정렬 연산(ordered operation) 과 비정렬 연산(unordered operation) 에 호환성 있게 사용 가능한 값
- 도큐먼트 내 배열은 몽고DB가 배열의 구조를 이해한다
  - 배열에 쿼리하거나 배열의 내용을 이용해 인덱스를 만들 수 있다

## 내장 도큐먼트
- 몽고DB는 내장 도큐먼트의 구조를 이해하고 인덱스를 구성하고 쿼리하며 갱신하기 위해 내장 도큐먼트 내부에 접근한다

## _id 와 ObjectId
- 몽고DB에 저장된 모든 도큐먼트는 `_id` 키를 가진다
- `_id` 키 값의 데이터형은 `ObejctId` 가 기본이다
- `_id`는 컬렉션 내에서 유일성을 가진다

### ObejctIds
- 분산 특성 때문에 자동 증가하는 기본키가 아닌 `ObjectId` 를 사용
- `ObjectId` 는 12바이트 스토리지를 사용하며 24자리 16진수 문자열 표현이 가능
  - 바이트당 2자리를 사용
