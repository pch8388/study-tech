# 파이프라인, 단계 및 조정 가능 항목
- 집계 프레임워크는 몽고DB 내 분석 도구 모음, 하나 이상의 컬렉션에 있는 도큐먼트에 대한 분석 수행
- 파이프라인 개념 기반
- 동일한 유형의 단계를 파이프라인에서 여러번 반복할 수도 있음
```javascript
> db.login_histories.aggregate([
    {$group: {_id: "$user_id", count:{$sum:1}, last_date:{$max:"$login_date"}}},
    {$match: {count: {$gte:50}, last_date: {$lt:ISODate("2021-08-24T00:00:00")}}},
    {$group: {_id: 1, count:{$sum:1}}}
], {allowDiskUse:true})
```
- 파이프라인의 각 단계에서 스트림처럼 데이터가 흐르면서 집계/분석 등을 처리한다

> 항상 집계 파이프라인의 효율성을 고려해야한다. 다음 파이프라인으로 전달되는 도큐먼트의 개수를 제한하여야 한다.

# 표현식
> [참고](https://docs.mongodb.com/manual/meta/aggregation-quick-reference/#std-label-aggregation-expressions])
- boolean expression : `$and, $or, $not`
- set expression : 배열을 집합으로 사용 
- comparison expression : 다양한 유형의 범위필터 표현
- arithmetic expression : 여러가지 산술표현식 표현
- string expression : 문자열 조작과 관련된 표현
- array expression : 배열 요소를 필터링, 분할, 특정 배열에서 값의 범위를 가져오는 등의 배열 조작
- variable expression : 하위 표현식에 대해 이름으로 접근할 수 있게 변수 설정
- accumulator : 합계, 기술 통계 및 기타 여러 유형의 값 계산
  - `$count, $group, $first, $last, $accumulator` 등등
  - `$accumulator` : 커스텀 accumulator 함수를 정의할 수 있다


