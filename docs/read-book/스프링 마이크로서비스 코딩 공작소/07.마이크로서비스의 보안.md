# OAuth2 소개
- 보호 자원(resource server) : 보호하려는 자원, 인증된 사용자만 액세스
- 자원 소유자(resource owner) : 서비스 호출자 (엔드 유저)
- 애플리케이션(client) : 사용자를 대신해 서비스를 호출할 애플리케이션
- 권한 부여 서버(authorization server) : 자원 소유자를 인증하고 자원 소유자의 승인을 받아서 클라이언트에게 토큰을 발급

<img width="495" alt="스크린샷 2022-03-07 오후 6 20 38" src="https://user-images.githubusercontent.com/17218212/157003046-210112dc-deab-45ae-869f-6c5fda7e62ed.png">

## 인증과 인가
- 인증(Authentication) : 자격 증명
- 인가(Authorization) : 리소스에 대한 접근 권한 여부

### oauth2 그랜트 타입
- 패스워드(password)
- 클라이언트 자격 증명(client credential)
- 인가 코드(authorization code)
- 암시적(implicit)

# OAuth2 인증 서비스
### 의존성 추가
```xml
<dependency>
  <groupId>org.springframework.cloud</groupId>
  <artifactId>spring-cloud-security</artifactId>
  <version>2.2.5.RELEASE</version>
</dependency>

<dependency>
  <groupId>org.springframework.cloud</groupId>
  <artifactId>spring-cloud-starter-oauth2</artifactId>
  <version>2.2.5.RELEASE</version>
</dependency>
```

### 부트스트랩 클래스 설정
```java
@SpringBootApplication
@EnableResourceServer       // 스프링 시큐리티 필터를 활성화하여 서비스를 보호하겠다고 명시
@EnableAuthorizationServer  // OAuth2 서비스가 될 것이라고 명시
@RestController
public class SecurityApplication {
  @RequestMapping(value = {"/user"}, produces = MediaType.APPLICATION_JSON_VALUE)
  public Map<String, Object> user(OAuth2Authentication user) {
    Map<String, Object> userInfo = new HashMap<>();
    userInfo.put("user", user.getUserAuthentication().getPrincipal());
    userInfo.put("authorities", AuthorityUtils.authorityListToSet(user.getUserAuthentication().getAuthorities()));
    return userInfo;
  }

  public static void main(String[] args) {
    SpringApplication.run(SecurityApplication.class, args);
  }
}
```